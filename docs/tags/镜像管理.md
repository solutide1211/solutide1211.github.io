---
title: Docker镜像管理
description: 镜像管理
author: solutide
page: true
date: 2025-07-30
category: Docker
tag:
  - Docker
  - 镜像
  - 容器
---
## 镜像管理

Docker 镜像是容器运行的基础，它是一个只读的模板，包含了运行应用程序所需的代码、库、环境变量和配置文件。良好的镜像管理是高效使用 Docker 的关键。本文将详细介绍 Docker 镜像的常用操作、最佳实践和优化技巧。

## 1. 查看本地镜像

使用 `docker images` 或 `docker image ls` 命令查看本地已有的镜像。

```bash
docker images

**# 或**

docker image ls
```

### 输出字段说明

|                |                                                           |
| -------------- | --------------------------------------------------------- |
| `REPOSITORY` | 镜像的仓库名称（如 `nginx`,`mysql`）                  |
| `TAG`        | 镜像的标签，通常表示版本（如 `latest`,`1.21-alpine`） |
| `IMAGE ID`   | 镜像的唯一 ID（哈希值）                                   |
| `CREATED`    | 镜像创建时间                                              |
| `SIZE`       | 镜像大小                                                  |

### 常用选项

```bash
# 只显示镜像 ID
docker images -q

# 显示所有镜像（包括中间层）
docker images -a

# 按大小排序
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"
```

---

## 🔽 2. 拉取镜像

从 Docker Hub 或私有仓库下载镜像。

```bash
# 拉取最新版 nginx
docker pull nginx

# 拉取指定版本
docker pull nginx:1.21-alpine

# 拉取私有仓库镜像
docker pull registry.example.com/myapp:v1.0
```

> 💡 提示：不指定 `:tag` 时，默认拉取 `latest` 标签。

---

## 🏗️ 3. 构建镜像

使用 `Dockerfile` 构建自定义镜像。

```bash
docker build -t myapp:v1.0 .
```

### 常用选项

|                     |                                                        |
| ------------------- | ------------------------------------------------------ |
| `-t`或 `--tag`  | 指定镜像名称和标签                                     |
| `-f`或 `--file` | 指定 Dockerfile 路径（如 `-f ./Dockerfile.prod`）    |
| `--no-cache`      | 构建时不使用缓存                                       |
| `--build-arg`     | 传递构建参数（如 `--build-arg NODE_ENV=production`） |

### 示例 Dockerfile

```Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

## 🚀 4. 运行容器

基于镜像启动容器。

```bash
docker run -d --name my-nginx -p 8080:80 nginx:latest
```

* `-d`：后台运行
* `--name`：指定容器名称
* `-p`：端口映射
* `-v`：挂载卷

---

## 📤 5. 推送镜像

将本地镜像推送到镜像仓库（如 Docker Hub、阿里云容器镜像服务）。

```
# 1. 登录仓库
docker login

# 2. 标记镜像（tag）
docker tag myapp:v1.0 username/myapp:v1.0

# 3. 推送
docker push username/myapp:v1.0
```

---

## 🗑️ 6. 删除镜像

```
# 删除指定镜像
docker rmi myapp:v1.0

# 强制删除（即使被容器使用）
docker rmi -f IMAGE_ID

# 删除所有未被使用的镜像（清理空间）
docker image prune
docker image prune -a  # 删除所有未被引用的镜像
```

> ⚠️ 注意：正在被容器使用的镜像无法删除，需先 `docker rm` 容器。

---

## 🔍 7. 查看镜像详情

```
docker inspect IMAGE_ID
```

输出 JSON 格式，包含镜像的构建信息、环境变量、CMD、网络配置等。

---

## 🧼 8. 镜像优化最佳实践

### ✅ 使用小基础镜像

优先使用 `alpine`、`slim` 等轻量镜像：

```
FROM node:18-alpine  # 而不是 node:18
```

### ✅ 合并 RUN 指令

减少镜像层数：

```
# 好的做法
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*
```

### ✅ 使用 .dockerignore

避免将不必要的文件（如 `node_modules`, `.git`）打包进镜像：

```
node_modules
.git
README.md
*.log
```

### ✅ 多阶段构建（Multi-stage Build）

适用于编译型语言（如 Go、Java、Node.js）：

```
# 构建阶段
FROM node:18 AS builder
WORKDIR /app
COPY . .
RUN npm run build

# 运行阶段
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

## 🔄 9. 镜像同步与备份

### 保存镜像为 tar 文件

```
docker save -o myapp.tar myapp:v1.0
```

### 从 tar 文件加载镜像

```
docker load -i myapp.tar
```

> 适用于离线环境或迁移。

---

## 📊 总结：常用命令速查

|          |                                   |
| -------- | --------------------------------- |
| 查看镜像 | `docker images`                 |
| 拉取镜像 | `docker pull nginx`             |
| 构建镜像 | `docker build -t myapp .`       |
| 推送镜像 | `docker push username/myapp`    |
| 删除镜像 | `docker rmi myapp`              |
| 保存镜像 | `docker save -o file.tar image` |
| 加载镜像 | `docker load -i file.tar`       |
