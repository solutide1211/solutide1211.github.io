---
title: 网络编程
description: 详解 Java 网络编程中的 IP、端口、TCP/UDP 通信及文件上传、聊天室实现
author: solutide
page: true
date: 2025-08-06
category: Java
tag:
  - Java
  - 网络编程
  - TCP
  - UDP
  - Socket
---

# 网络编程

## 概述

什么是计算机网络？

> 计算机网络是指将[地理位置](https://baike.baidu.com/item/地理位置/797988?fromModule=lemma_inlink)不同的具有独立功能的多台计算机及其[外部设备](https://baike.baidu.com/item/外部设备/3741161?fromModule=lemma_inlink)，通过[通信线路](https://baike.baidu.com/item/通信线路/1527630?fromModule=lemma_inlink)和通信设备连接起来，在[网络操作系统](https://baike.baidu.com/item/网络操作系统/3997?fromModule=lemma_inlink)，[网络管理软件](https://baike.baidu.com/item/网络管理软件/6579078?fromModule=lemma_inlink)及[网络通信协议](https://baike.baidu.com/item/网络通信协议/4438611?fromModule=lemma_inlink)的管理和协调下，实现[资源共享](https://baike.baidu.com/item/资源共享/233480?fromModule=lemma_inlink)和[信息传递](https://baike.baidu.com/item/信息传递/8232801?fromModule=lemma_inlink)的[计算机系统](https://baike.baidu.com/item/计算机系统/7210959?fromModule=lemma_inlink)。 [1]
>
> 计算机网络主要是由一些通用的、可编程的硬件互连而成的。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。

网络编程的目的

    数据交换、通信。

实现通信需要什么？

1. 如何准确定位网络上的一台主机    `ip + 端口` 还要定位到主机上的某个资源
2. 找到了主机，如何传输数据

---

## 网络通信的两个要素

如何实现网络的通信？

1. 通信双方地址：
   - `ip`
   - 端口号


2. 规则：网络通信的协议  `TCP/UDP`

    TCP/IP 参考模型

![](https://note-1334192270.cos.ap-nanjing.myqcloud.com/notePicture/202508061523864.png)

---

## IP

`ip`地址：`inetAddrress`

- 唯一定义一台网络上的计算机
- 127.0.0.1   <==>  localhost (本机)
- `ip` 地址分类
  - IPV4/IPV6	4个字节
  - 公网/私网
- 域名：记忆IP问题

## 端口

端口表示计算机的一个程序的进程：

- 不同的进程有不同的端口，用来区分软件
- 被规定：0-65535
- TCP/UDP: 65535 * 2  ； 单个协议下，端口号不能冲突
- 端口分类
  - 公有端口 0-1023
    - http  80
    - https  443
    - ftp 21
    - ssh 22
  - 程序注册端口 1024-49151 分配用户或程序
    - Tomcat  8080
    - Mysql 3306
  - 动态： 私有  49152-65535

## 通信协议

**网络通信协议**： 速率，传输码率、代码结构、传输控制...

**TCP/IP**协议簇

重要：

- TCP： 用户传输协议
- UDP: 用户数据报协议

出名的协议：

TCP/IP协议：网络互联协议

### TCP、UDP对比

tcp： 打电话

- 连接稳定
- `三次握手、四次分手`

  > 最少需要三次保证稳定链接服务端、客户端,
  >
- 传输完成，释放连接，效率低

**客户端**

```java
public class TcpClientDemo {
    public static void main(String[] args) {
        Socket socket = null;
        OutputStream os = null;
        try {
            socket = new Socket("127.0.0.1", 8081);
            os = socket.getOutputStream();
            os.write("欢迎来到JAVA的世界sfnajsfn+*这是测试这是测试".getBytes());
        } catch (IOException e) {
            throw new RuntimeException(e);
        }finally {
            if(os != null){
                try {
                    os.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if(socket != null){
                try {
                    socket.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
        }

    }
}
```

**服务端**

```java
public class TcpServerDemo {

    public static void main(String[] args) {

        ServerSocket serverSocket = null;
        Socket accept = null;
        InputStream inputStream = null;
        try {

            serverSocket = new ServerSocket(8081);
            accept = serverSocket.accept();
            inputStream = accept.getInputStream();

            byte[] bytes = new byte[7];
            int len;
            while((len = inputStream.read(bytes))!=-1){
                System.out.println(new String(bytes, 0, len));
            }
        } catch (IOException e) {
            throw new RuntimeException(e);
        }finally {
            if (inputStream != null) {
                try {
                    inputStream.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if (accept != null) {
                try {
                    accept.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if (serverSocket != null) {
                try {
                    serverSocket.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}
```

> 现在客户端发送的消息会发生中文被切割，导致乱码

```
欢迎�
��到JA
VA的�
�界sfn
ajsfn+*
这是�
��试�
�是测
试
```

**服务端改进**

```java
public class TcpServerDemo {

    public static void main(String[] args) {

        ServerSocket serverSocket = null;
        Socket accept = null;
        InputStream inputStream = null;
        ByteArrayOutputStream baos = null;
        try {

            serverSocket = new ServerSocket(8081);
            accept = serverSocket.accept();
            inputStream = accept.getInputStream();
            int len;
            byte[] buffer = new byte[7];
            baos = new ByteArrayOutputStream();
            while ((len = inputStream.read(buffer)) != -1) {
                baos.write(buffer, 0, len);
            }
            System.out.println(baos.toString());
        } catch (IOException e) {
            throw new RuntimeException(e);
        } finally {
            if (baos != null) {
                try {
                    baos.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if (inputStream != null) {
                try {
                    inputStream.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if (accept != null) {
                try {
                    accept.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
            if (serverSocket != null) {
                try {
                    serverSocket.close();
                } catch (IOException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}
```

将发送的消息的字节流全部写入字节数组输出流 `ByteArrayOutputStream`中,然后直接将全部字节转成字符串

udp： 发短信

- 不连接、不稳定
- 客户端、服务端没有明确的界限
  - 不需要明确目标的状态，可以直接发送

## TCP文件上传

**服务端**

```java
package com.liu.NetWork_.TcpUploadFile;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.nio.charset.StandardCharsets;

public class uploadFileServer {

    public static void main(String[] args) throws Exception {
        ServerSocket serverSocket = new ServerSocket(8988);
        Socket socket = serverSocket.accept();
        InputStream inputStream = socket.getInputStream();
        int len;
        byte[] buffer = new byte[1024];
        FileOutputStream recieved = new FileOutputStream(new File("recieved"));
        while((len = inputStream.read(buffer)) != -1){
            recieved.write(buffer,0,len);
        }
        // 通知客户端接收完毕
        OutputStream outputStream = socket.getOutputStream();
        outputStream.write("close".getBytes(StandardCharsets.UTF_8));

        // 关闭流
        outputStream.close();
        recieved.close();
        socket.close();
        serverSocket.close();
    }
}

```

**客户端**

```java
package com.liu.NetWork_.TcpUploadFile;

import java.io.ByteArrayOutputStream;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetAddress;
import java.net.Socket;
import java.nio.charset.StandardCharsets;

public class uploadFileClient {

    public static void main(String[] args) throws Exception {
        Socket socket = new Socket(InetAddress.getByName("127.0.0.1"), 8988);

        OutputStream outputStream = socket.getOutputStream();
        FileInputStream inputStream = new FileInputStream("upload.txt");
        byte[] buffer = new byte[1024];
        int len = 0;
        while ((len = inputStream.read(buffer)) != -1) {
            outputStream.write(buffer, 0, len);
        }

        // 写入完毕
        socket.shutdownOutput();
      
        // 接收服务端发送的接收完毕消息
        InputStream socketInputStream = socket.getInputStream();
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        byte[] buffer1 = new byte[1024];
        int len1 = 0;
        while ((len1 = socketInputStream.read(buffer1)) != -1) {
            out.write(buffer1, 0, len1);
        }
        System.out.println(out.toString(StandardCharsets.UTF_8));

        // 关闭流
        out.close();
        socketInputStream.close();
        inputStream.close();
        outputStream.close();
        socket.close();
    }
}

```

## UDP消息发送

**服务端**

```java
package com.liu.NetWork_.udp_;

import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.Arrays;

public class udpServer {

    public static void main(String[] args) throws Exception {
        DatagramSocket socket = new DatagramSocket(8899);

        byte[] buf = new byte[1024];
        DatagramPacket pocket = new DatagramPacket(buf,0,buf.length);

        socket.receive(pocket);
        System.out.println(pocket.getAddress().getHostAddress());
        System.out.println(new String(pocket.getData(),0,pocket.getLength()));
        socket.close();
    }
}

```

**客户端**

```java
package com.liu.NetWork_.udp_;

import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.nio.charset.StandardCharsets;

public class updClient {

    public static void main(String[] args) throws Exception {
        //创建发送目标
        DatagramSocket socket = new DatagramSocket();
        // 创建包
        String msg = "jdasfnajdgvnad";
        DatagramPacket pocket = new DatagramPacket(
                msg.getBytes(StandardCharsets.UTF_8),
                0,
                msg.getBytes().length,
                InetAddress.getByName("127.0.0.1"),
                8899
        );

        // 发送包
        socket.send(pocket);
        socket.close();
    }
}

```

## UDP聊天实现

**消息发送方**

```java
package com.liu.NetWork_.udp_.chat;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.nio.charset.StandardCharsets;

public class chatClient {

    public static void main(String[] args) throws Exception {
        DatagramSocket socket = new DatagramSocket();
        while (true) {
            String msg = new BufferedReader(new InputStreamReader(System.in)).readLine();
            byte[] bytes = msg.getBytes(StandardCharsets.UTF_8);
            String data = new String(bytes);
            DatagramPacket packet = new DatagramPacket(
                    bytes,
                    0,
                    bytes.length,
                    InetAddress.getByName("127.0.0.1"),
                    6666
            );
            socket.send(packet);
            if ("exit".equals(data)) {
                break;
            }

        }
        socket.close();
    }
}

```

**消息接收方**

```java
package com.liu.NetWork_.udp_.chat;

import java.net.DatagramPacket;
import java.net.DatagramSocket;

public class chatServer {

    public static void main(String[] args) throws Exception {
        DatagramSocket socket = new DatagramSocket(6666);
        while (true) {
            DatagramPacket packet = new DatagramPacket(new byte[1024], 0, 1024);
            socket.receive(packet);
            String data = new String(packet.getData(),0, packet.getLength());
            System.out.println(data);
            if("exit".equals(data)){
                break;
            }
        }
        socket.close();
    }
}

```
